<ng-container *ngIf="!(loading$ | async); else loadingRef">
  <div #search>
    <s4e-search
      placeholder="Wpisz szukaną miejscowość..."
      [searchResults]="searchResults$ | async"
      [isSearchLoading]="searchResultsLoading$ | async"
      [isSearchOpen]="searchResultsOpen$ | async"
      [value]="searchValue"
      (selectResult)="navigateToPlace($event)"
      (refreshResults)="searchForPlaces($event)"
      (resetSearch)="resetSearch()"
      (selectFirstResult)="selectFirstResult()">
      <ng-template #result let-result>
        <span class="name">{{ result.name }}</span>
        <span class="type">{{ result.type }}</span>
        <span class="voivodeship">{{ result.voivodeship}}</span>
      </ng-template>
    </s4e-search>
  </div>

  <s4e-items-picker
    #picker

    mwlResizable
    resizeCursorPrecision="10"
    [resizeEdges]="{ top: true }"
    (resizeEnd)="onResizeEnd($event)"

    class="section layers"
    caption="Warstwy"
    i18n-caption
    [loading]="overlaysLoading$ | async"
    [items]="overlays$ | async"
    (itemSelected)="selectOverlay($event)"
  >
  </s4e-items-picker>

  <div class="products-list">
    <div *ngIf="isLoggedIn"  class="products-filtration">
      <a data-e2e="product-list"
         [ngClass]="{'active': !isFavouriteFiltration}" (click)="setViewModeToFavourite(false)" i18n>Lista produktów</a>
      <a data-e2e="favourite-list"
         [ngClass]="{'active': isFavouriteFiltration}" (click)="setViewModeToFavourite(true)">
        <span class="badge"><small data-e2e="favourite-count">{{ favouriteProductsCount$ | async }}</small></span>
        <ng-container i18n>Ulubione</ng-container>
      </a>
    </div>
    <ng-container *ngIf="isLoggedIn && isFavouriteFiltration && (favouriteProductsCount$ | async) === 0; else products">
      <div class="products products--favourite">
        <header>
          <span class="products__title products__title--favourite">Ulubione</span>
        </header>
        <section>
          <div class="empty">
            <p i18n>Jeszcze nie zostały dodane żadne ulubione produkty.</p>
            <p i18n>Może to zrobić klikając gwiazdkę na lisćie produktów</p>
          </div>
        </section>
      </div>
    </ng-container>
    <ng-template #products>
      <s4e-items-picker
        class="section products"
        caption="Produkty"
        i18n-caption
        [loading]="productsLoading$ | async"
        [items]="products$ | async"
        [hasFavourite]="isLoggedIn"
        (itemSelected)="selectProduct($event)"
        (isFavouriteSelected)="isFavouriteProduct($event.ID, $event.isFavourite)"
      >
      </s4e-items-picker>
    </ng-template>
    <div [s4eDynamicSpace]="pickerRef"></div>
  </div>

</ng-container>
<ng-template #loadingRef>
  <div class="loading loading--form">
    <div class="loading__item"></div>
    <div class="loading__item"></div>
    <div class="loading__item"></div>
    <div class="loading__item"></div>
    <div class="loading__item"></div>
    <div class="loading__item"></div>
  </div>
</ng-template>
