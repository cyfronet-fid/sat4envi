
<div
  class="section sidebar"
  [@sidebar]="(sidebarOpen$ | async) ? 'open' : 'closed'"
  [ngClass]="{open: isMobileSidebarOpen}"
>
  <div class="collapse" (click)="mapService.toggleSidebar()" [ngClass]="(sidebarOpen$ | async) ? 'open' : 'closed'"></div>
  <ul class="switch">
    <li [class.active]="isLinkActive('products')">
      <a [routerLink]="['./products']" queryParamsHandling="preserve" i18n>Zdjęcia Satelitarne</a>
    </li>
    <li [class.active]="isLinkActive('sentinel-search')">
      <a [routerLink]="['./sentinel-search']" queryParamsHandling="preserve" i18n>Szukaj Danych</a>
    </li>
  </ul>
  <div class="sidebar-content">
    <router-outlet></router-outlet>
  </div>
</div>

<s4e-legend *ngIf="legend$ | async"
            [isOpen]="(legendState$ | async).isOpen"
            (opened)="toggleLegend()"
            [activeLegend]="legend$ | async"
            class="legend"></s4e-legend>

<s4e-timeline class="section timeline"
              *ngIf="(activeProducts$ | async) != null"
              [scenes]="(timelineUI$ | async)?.scenes"
              [startTime]="(timelineUI$ | async)?.startTime"
              [currentDate]="currentTimelineDate$ | async"
              (dateSelected)="setDate($event)"
              [availableDates]="availableDates$ | async"
              (lastAvailableScene)="getLastAvailableScene()"
              (loadAvailableDates)="loadAvailableDates($event)"
              (nextScene)="nextScene()"
              (previousScene)="previousScene()"
              (nextDay)="nextDay()"
              (increaseResolution)="increaseResolution()"
              (decreaseResolution)="decreaseResolution()"
              [resolution]="timelineResolution$ | async"
              (previousDay)="previousDay()"
              [loading]="scenesAreLoading$ | async"
              [activeScene]="activeScene$ | async"
              (selectedScene)="selectScene($event?.id)"
              [ngClass]="(sidebarOpen$ | async) ? 'open' : 'closed'"
>
</s4e-timeline>

<s4e-map class="section map"
         #map
         [isSentinelSearch]="isLinkActive('sentinel-search')"
         [overlays]="overlays$ | async"
         [activeScene]="activeScene$ | async"
         [activeView]="activeView$ | async"
         (viewChanged)="viewChanged($event)"
         [ngClass]="(sidebarOpen$ | async) ? 'open' : 'closed'"
>
</s4e-map>
<div
  s4eEvents
  (outsideClick)="toggleLoginOptions(false)"
  (routerChange)="toggleLoginOptions(false)"
>
  <button
    (click)="toggleLoginOptions()"
    id="user-login-button"
    [className]="(userLoggedIn$ | async) ? 'dropdown__button dropdown__button--loginactive' : 'dropdown__button dropdown__button--login'"

  >
  </button>
  <ng-container *ngIf="showLoginOptions$ | async">
    <div class="dropdown__content dropdown__content--login">
      <div class="dropdown__header">
        <img src="/assets/images/logo_s4e_color.png" width="60" alt="Logo Sat4Envi" />
        <a href="https://sat4envi.imgw.pl"><strong>Przejdź do strony projektu</strong></a>
      </div>
      <div class="dropdown__close" (click)="toggleLoginOptions(false)"></div>
      <section>
        <dl>
          <dt>Operacje widoku</dt>
          <dd><a
            (click)="openShareViewModal()"
            href="javascript:undefined"
            i18n
          >
            Wyślij widok na adres email
          </a></dd>
          <dd><a
            (click)="openSaveViewModal()"
            href="javascript:undefined"
            data-e2e="open-save-view-modal-btn"
            i18n
          >
            Zapisz konfigurację widoku w aplikacji
          </a></dd>
          <dd><a
            (click)="openListViewModal()"
            href="javascript:undefined"
            data-e2e="open-views-modal-btn"
            i18n
          >
            Wczytaj zapisaną konfigurację
          </a></dd>
          <dd><a
            (click)="openExpertHelpModal()"
            href="javascript:undefined"
            i18n
          >
            Wsparcie eksperckie
          </a></dd>

          <dt>Raporty</dt>
          <dd><a
            (click)="openReportModal()"
            href="javascript:undefined"
            i18n
          >
            Wygeneruj raport PDF
          </a></dd>
          <dd><a
            (click)="openReportTemplatesModal()"
            href="javascript:undefined"
            i18n
          >
            Szablony raportów
          </a></dd>

          <dt>Zapisywanie na dysk</dt>


          <dd><a
            data-test-download-original
            [ngClass]="{disabled: (activeScene$ | async) == null}"
            [attr.href]="activeSceneUrl$ | async"
            target="_blank"
            i18n
          >
            Zapisz źródło widoku (surowe dane)
          </a></dd>
          <dd><a
            (click)="downloadMapImage()"
            href="javascript:undefined"
            i18n
          >
            Zapisz na dysku jako obraz PNG
          </a></dd>
        </dl>
        <dl>
          <dt>Zarządzanie kontem</dt>
          <dd>
            <a routerLink="/settings" i18n>Panel administracyjny</a>
          </dd>
          <dd>
            <a routerLink="/profile" i18n>Twój profil</a>
          </dd>
          <dd>
            <a
              href="javascript:void(0)"
              (click)="openJwtTokenModal()"
              data-e2e="open-jwt-token-btn"
              i18n
            >
              Pobierz token API
            </a>
          </dd>


          <dt>Dostępność</dt>
          <dd>
            <a href="javascript:void(0)" (click)="toggleHighContrast()">
              {{ (hasHeightContrast | async) ? 'Wyłącz' : 'Włącz' }} wysoki kontrast
            </a>
          </dd>
          <dd>
            <a href="javascript:void(0)" (click)="toggleLargeFont()">
              {{ (hasLargeFont | async) ? 'Wyłącz' : 'Włącz' }} powiększoną czcionkę
            </a>
          </dd>
        </dl>
        <div class="dropdown__login">
          <a routerLink="/logout" class="button button--small button--primary" i18n>Wyloguj</a>
        </div>
        <ng-container *ngIf="!(userLoggedIn$ | async); else loginOptions">
          <div class="dropdown__login">
            <a routerLink="/login" i18n class="button button--small button--primary">
              Zaloguj / Zarejestruj
            </a>
          </div>
        </ng-container>
      </section>
    </div>
  </ng-container>
</div>
<div
  s4eEvents
  *ngIf="userIsZK$ | async"
  (outsideClick)="toggleZKOptions(false)"
  (routerChange)="toggleZKOptions(false)"
>
  <button
    (click)="toggleZKOptions()"
    id="zk-options-button"
    class="dropdown__button dropdown__button--zk"
    data-e2e="zk-options-btn"
  >
  </button>
  <ng-container *ngIf="showZKOptions$ | async">
    <div class="dropdown__content dropdown__content--zk">
      <span class="dropdown__header">Dodatkowe funkcjonalności</span>
      <div class="dropdown__close dropdown" (click)="toggleZKOptions(false)"></div>
      <ul>
        <li><a
          (click)="openReportModal()"
          href="javascript:undefined"
          i18n
        >
          Wygeneruj raport (pdf)
        </a></li>
        <li><a
          (click)="openReportTemplatesModal()"
          href="javascript:undefined"
          i18n
        >
          Szablony raportów
        </a></li>
        <li><a
          (click)="openShareViewModal()"
          href="javascript:undefined"
          i18n
        >
          Wyślij widok na adres email
        </a></li>
        <li><a
          (click)="openExpertHelpModal()"
          href="javascript:undefined"
          i18n
        >
          Wsparcie eksperckie
        </a></li>
        <li><a
          (click)="openSaveViewModal()"
          href="javascript:undefined"
          data-e2e="open-save-view-modal-btn"
          i18n
        >
          Zapisz konfigurację widoku
        </a></li>
        <li><a
          (click)="openListViewModal()"
          href="javascript:undefined"
          data-e2e="open-views-modal-btn"
          i18n
        >
          Wczytaj zapisaną konfigurację
        </a></li>
        <li><a
          data-test-download-original
          [ngClass]="{disabled: (activeScene$ | async) == null}"
          href="javascript:undefined"
          (click)="showDetailsModal()"
          i18n
        >
          Zapisz oryginał na dysku...
        </a></li>
        <li><a
          (click)="downloadMapImage()"
          href="javascript:undefined"
          i18n
        >
          Zapisz na dysku (png)
        </a></li>
      </ul>
    </div>
  </ng-container>
</div>

<button
  (click)="isMobileSidebarOpen = !isMobileSidebarOpen"
  class="dropdown__button dropdown__button--products"
>
</button>

<button *ngIf="activeProducts$ | async"
        (click)="toggleProductDescription()"
        id="product-description-button"
        class="dropdown__button dropdown__button--product"
        [ngClass]="(sidebarOpen$ | async) ? 'open' : 'closed'">
</button>
<ng-container *ngIf="showProductDescription$ | async">
  <div class="dropdown__content dropdown__content--product" [ngClass]="(sidebarOpen$ | async) ? 'open' : 'closed'">
    <span class="dropdown__header" i18n>Opis produktu</span>
    <div class="dropdown__close dropdown" (click)="toggleProductDescription(false)"></div>
    <h2>{{(activeProducts$ | async).displayName}}</h2>
    <div class="dropdown__description" [innerHTML]="(activeProducts$ | async).description">
    </div>
  </div>
</ng-container>
